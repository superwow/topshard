# TopShard (MVP, CodeIgniter 4)

TopShard — каталог игровых серверов (Lineage II, WoW, Rust, Minecraft, GTA и др.). Этот репозиторий содержит MVP на CodeIgniter 4 с тёмной темой, базовыми страницами и схемой БД.

## Что внутри (PR1)
- Стартовый каркас CodeIgniter 4 (PHP 8.2+), строгая структура `app/`, `public/`, `writable/`.
- Статические страницы: главная `/`, каталог `/servers`, правила `/rules`, промо `/promo`, about `/about`.
- Миграции и сиды для таблиц `servers`, `votes`, `metrics_daily`, `reports`.
- Базовые вьюшки и layout в тёмной теме, заглушки под метрики/графики.

## Что добавили в PR2
- Каталог `/servers` стал «живым»: поиск по названию/описанию, фильтры по игре/типу/рейтам/региону/языку и сортировка.
- Карточка сервера `/server/{slug}` с бейджем статуса, блоками описания/особенностей, ссылками и подключением, а также похожими серверами по игре.
- В каталоге показываются только активные сервера, пагинация по 9 штук и быстрый переход на карточку.

## Что добавили в PR3
- `/add` — форма добавления сервера. Валидация, автоматический slug и сохранение со статусом pending.
- `/admin` — модерация: вход по паролю из `.env` (`app.adminPassword`), просмотр pending-заявок, кнопки «Одобрить» и «Отклонить».
- При одобрении сервер становится `active` и появляется в каталоге, при отклонении получает статус `disabled`.

## Что добавили в PR5
- Рейтинг и тренды на главной по голосам за 24 часа и 7 дней.
- В карточке сервера показываем рейтинг, тренд и разбивку голосов (24ч/7д/всего).
- В каталоге отображаются свежие метрики голосов и рейтинг для каждого сервера.

## Требования
- PHP 8.2+
- MySQL 8+ (или совместимый MariaDB)
- Composer

## Запуск локально
```bash
composer install
cp .env.example .env
php spark key:generate

# настройте подключение к базе в .env
php spark migrate
php spark db:seed DatabaseSeeder

php spark serve --host=0.0.0.0 --port=8080
# откройте http://localhost:8080/
```

## Страницы
- `/` — hero, топ, тренды (заглушки).
- `/servers` — каталог с поиском и фильтрами (game/type/rates/region/language), только активные.
- `/server/{slug}` — карточка сервера с описанием, ссылками и похожими проектами.
- `/add` — добавление сервера, сохраняется как pending.
- `/admin` — модерация: вход по паролю из `.env` (`app.adminPassword`), кнопки approve/disable.
- `/rules`, `/promo`, `/about` — статические страницы.

## Миграции (MVP)
- `servers` — основная таблица.
- `votes` — голоса (1 раз / 24ч — в будущих PR).
- `metrics_daily` — онлайн/аптайм (будет обновляться воркером).
- `reports` — жалобы на серверы.

## Seed-данные
Файл `app/Database/Seeds/ServerSeeder.php` — 5 демо-серверов с разными играми/типами. После `db:seed` появятся в каталоге.

## Тестирование
Базовые HTTP-тесты появятся в следующих PR. Сейчас можно проверить вручную:
```bash
php spark serve
# открыть http://localhost:8080/ и http://localhost:8080/servers
```

## Логи и метрики
- Включён отдельный канал `metrics` (папка `writable/logs/metrics/`) — пока заглушка для будущего cron/воркера.
- TODO: подключить сбор метрик через `spark metrics:collect` (PR7).

## TODO в следующих этапах
- Реальный каталог и страница сервера с фильтрами/пагинацией (PR2).
- Добавление серверов и админ-модерация (PR3).
- Голосование и лимиты (PR4).
- Рейтинг и тренды (PR5).
- Жалобы (PR6). Расширенные правила `/rules` — готовы.
- Cron-команда для метрик (PR7).
